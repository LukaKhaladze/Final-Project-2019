define("promo/fest/balloon.all",[],function(){var o=Function("return this")();if(!o.fest)o.fest={};o.fest["balloon.all"]=function(o){"use strict";function t(o){p(o+'\nin block "'+w+'" at line: '+v+"\nfile: "+g)}function e(o){return T[o]}function i(o){if("string"==typeof o){if(B.test(o))return o.replace(y,e)}else if(void 0===o)return"";return o}var n,s,a,l,r,c,h,p,d=this,u="",m=[],b=[],f="",_={},g="",v="",w="",y=/[&<>"]/g,B=/[&<>"]/,T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},i18n=d&&"function"==typeof d.i18n?d.i18n:function(o){return o};if("undefined"==typeof __fest_error)p="undefined"!=typeof console&&console.error?function(){return Function.prototype.apply.call(console.error,console,arguments)}:function(){};else p=__fest_error;var $=o;!function(o){var e=o;_.balloon=function(o){var n="";n+='<div id="TipOfTheDay" class="balloon" style="left:0; top:-300px; display: none;"><div class="balloon__t"><i class="balloon__cn balloon__cn_tl"></i><i class="balloon__cn balloon__cn_tr"></i><i class="balloon__cn balloon__cn_tc"></i></div><div class="balloon__i">';try{a=!e.withoutIcon}catch(o){a=!1;t(o.message)}if(a){try{b[0]=i(i18n("Закрыть"))}catch(o){b[0]="";t(o.message)}n+='<i class="balloon__icon" title="'+b[0]+'">&times;<i></i></i>'}n+='<i class="balloon__sh balloon__sh_l"></i><i class="balloon__sh balloon__sh_r"></i><i class="balloon__cn balloon__cn_lc"></i><i class="balloon__cn balloon__cn_rc"></i><div class="balloon__content th-place"></div></div><div class="balloon__b"><i class="balloon__cn balloon__cn_bl"></i><i class="balloon__cn balloon__cn_br"></i></div></div>';return n}}(o);!function(o){_.balloon__filesearch=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_filesearch"></i></div><div class="balloon__message">';try{e+=i18n("Все вложения в письмах")}catch(o){t(o.message+"7")}e+=' <a href="/filesearch" class="balloon__message__link">';try{e+=i18n("можно посмотреть здесь")}catch(o){t(o.message+"10")}e+="</a></div>";return e}}();!function(o){_.balloon__nospam=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_nospam"></i></div><div class="balloon__message">';try{e+=i18n("Нажмите «Не спам», и письма от этого адресата всегда будут приходить в папку «Входящие».")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__spam=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_spam"></i></div><div class="balloon__message">';try{e+=i18n("Нажмите «Это спам», и письма от этого адресата всегда будут приходить в папку «Спам».")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){var e=o;_["balloon__theme-weather"]=function(o){var n="";n+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_theme-weather"></i></div><div class="balloon__message">';try{n+=i18n("Установите новую")}catch(o){t(o.message+"7")}n+=" ";try{b[0]=i(e.href)}catch(o){b[0]="";t(o.message)}n+='<a href="'+b[0]+'">';try{n+=i18n("Погодную")}catch(o){t(o.message+"10")}n+="</a> ";try{n+=i18n("тему оформления в Почте.")}catch(o){t(o.message+"13")}n+="</div>";return n}}(o);!function(o){_["balloon__edit-attach"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_edit-attach"></i></div><div class="balloon__message">';try{e+=i18n("Редактор фотографий в почте.")}catch(o){t(o.message+"7")}e+=' <a class="js-balloon__link balloon__message__link" href="#">';try{e+=i18n("Попробовать")}catch(o){t(o.message+"10")}e+="</a></div>";return e}}();!function(o){var e=o;_.balloon__horoscope=function(o){var n="";n+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_theme-horoscope"></i></div><div class="balloon__message">';try{n+=i18n("Ваш персональный гороскоп в Почте. Установите новую")}catch(o){t(o.message+"7")}n+=" ";try{b[0]=i(e.href)}catch(o){b[0]="";t(o.message)}n+='<a href="'+b[0]+'">';try{n+=i18n("тему")}catch(o){t(o.message+"10")}n+="</a> ";try{n+=i18n("оформления.")}catch(o){t(o.message+"13")}n+="</div>";return n}}(o);!function(o){_.balloon__cleaner=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_cleaner"></i></div><div class="balloon__message">';try{e+=i18n("Устали от рассылок?")}catch(o){t(o.message+"7")}e+="<br/>";try{e+=i18n("Мы поможем убрать их из «Входящих».")}catch(o){t(o.message+"9")}e+='<br/><a class="js-mailbox-sort" href="#">';try{e+=i18n("Разобрать ящик")}catch(o){t(o.message+"12")}e+="</a></div>";return e}}();!function(o){_["balloon__cleaner-archive"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_cleaner"></i></div><div class="balloon__message">';try{e+=i18n("Ваши рассылки и уведомления из&nbsp;социальных сетей тут")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__pins=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_pins"></i></div><div class="balloon__message">';try{e+=i18n("Отметьте важное письмо")}catch(o){t(o.message+"7")}e+="<br/>";try{e+=i18n("или поставьте напоминание,")}catch(o){t(o.message+"9")}e+="<br/>";try{e+=i18n("чтобы ответить на него позже")}catch(o){t(o.message+"11")}e+="</div>";return e}}();!function(o){_.balloon__emoji=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_emoji"></i></div><div class="balloon__message">';try{e+=i18n("Добавьте в&nbsp;письмо эмоций!")}catch(o){t(o.message+"7")}e+="<br/>";try{e+=i18n("Используйте «Эмодзи» при&nbsp;написании письма")}catch(o){t(o.message+"9")}e+="</div>";return e}}();!function(o){_["balloon__inline-image"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_images"></i></div><div class="balloon__message">';try{e+=i18n("Вставьте картинку прямо")}catch(o){t(o.message+"7")}e+="<br/>";try{e+=i18n("в своё письмо.")}catch(o){t(o.message+"9")}e+="</div>";return e}}();!function(o){var e=o;_["balloon__theme-zenit"]=function(o){var n="";n+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_theme-zenit"></i></div><div class="balloon__message" style="margin: 6px 0 -6px;">';try{n+=i18n("Болеете за свою команду?")}catch(o){t(o.message+"7")}n+="<br/>";try{b[0]=i(e.href)}catch(o){b[0]="";t(o.message)}n+='<a href="'+b[0]+'" class="balloon__message__link">';try{n+=i18n("Установите")}catch(o){t(o.message+"10")}n+="</a> ";try{n+=i18n("тему «Зенит»")}catch(o){t(o.message+"13")}n+="</div>";return n}}(o);!function(o){_.balloon__attachFromCloud=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_cloud"></i></div><div class="balloon__message" style="min-height: auto; padding: 3px;"><span class="js-balloon29-cloud-exists" style="display: none;">';try{e+=i18n("Отправляя письмо, вы можете прикрепить к нему файлы из Облака.")}catch(o){t(o.message+"8")}e+='</span><span class="js-balloon29-cloud-not-exists" style="display: none;">';try{e+=i18n("Прикрепляйте файлы к письму из Облака. Создайте свое Облако для хранения фото, документов и других файлов.")}catch(o){t(o.message+"11")}e+="</span></div>";return e}}();!function(o){_.balloon__cloud=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_cloud"></i></div><div class="balloon__message">';try{e+=i18n("Храните фото, видео,")}catch(o){t(o.message+"7")}e+="<br/>";try{e+=i18n("музыку и документы")}catch(o){t(o.message+"9")}e+='<br/><a href="//r.mail.ru/clb2299292/cloud.mail.ru/?utm_source=mail_bubble&amp;utm_medium=bubble&amp;utm_campaign=cloud+promo" class="balloon__message__link" target="_blank">';try{e+=i18n("в Облаке")}catch(o){t(o.message+"12")}e+="</a></div>";return e}}();!function(o){_.balloon__collector=function(o){var e="";e+='<div class="popup-settings__head"><div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_collector"></i></div><div class="balloon__message">';try{e+=i18n("Соберите письма из других почтовых ящиков в эту почту")}catch(o){t(o.message+"8")}e+='</div></div><ul class="balloon__message__list"><li class="balloon__message__list__item">';try{e+=i18n("Читать и отвечать на почту удобнее из одного почтового ящика")}catch(o){t(o.message+"13")}e+='</li><li class="balloon__message__list__item">';try{e+=i18n("Вы сохраните доступ к другим почтовым ящикам и сможете заходить в них, если это будет необходимо")}catch(o){t(o.message+"16")}e+='</li><li class="balloon__message__list__item">';try{e+=i18n("Ваши письма в других ящиках также будут сохранены, мы лишь скопируем их в этот почтовый ящик")}catch(o){t(o.message+"19")}e+='</li></ul><div class="popup-settings__controls popup-settings__controls_blank"><form action="/settings/collector"><button type="submit" class="btn btn_main confirm-ok" cnt_sb="816843"><span class="btn__text">';try{e+=i18n("Настроить сборщик")}catch(o){t(o.message+"26")}e+='</span></button><button class="btn js-hide" cnt_sb="816845"><span class="btn__text">';try{e+=i18n("Это мой первый почтовый ящик")}catch(o){t(o.message+"31")}e+="</span></button></form></div>";return e}}();!function(o){_.balloon__multiAuth=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon_multiAuth"></i></div><div class="balloon__message" style="text-align:left">';try{e+=i18n("Используйте одновременно несколько почтовых ящиков")}catch(o){t(o.message+"7")}e+=" ";try{e+=i(patron.SingleProductName)}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__archiveFolder=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_archive-folder"></i></div><div class="balloon__message">';try{e+=i18n("Переместите в папку «Архив» старые письма")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__expandArchive=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_expand-archive"></i></div><div class="balloon__message">';try{e+=i18n("Смотрите файлы из&nbsp;архивов, не&nbsp;скачивая их на компьютер")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__composeTemplates=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_compose-templates"></i></div><div class="balloon__message">';try{e+=i18n("Создайте шаблон письма и отправляйте его по мере необходимости")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__composeTemplatesReply=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_compose-templates-reply"></i></div><div class="balloon__message"><span class="js-reply" style="display: none;">';try{e+=i18n("Сохраните этот ответ как шаблон, чтобы отправлять его моментально в будущем.")}catch(o){t(o.message+"8")}e+='</span><span class="js-forward" style="display: none;">';try{e+=i18n("Часто отправляете это письмо? Сохраните его как шаблон!")}catch(o){t(o.message+"11")}e+="</span></div>";return e}}();!function(o){_["balloon__letters-head-actions"]=function(o){var e="";e+='<div class="balloon__message" style="padding: 0 5px 5px;"><div class="balloon__title">';try{e+=i18n("Действия с письмом")}catch(o){t(o.message+"5")}e+='</div><div class="balloon__list-item"><div class="balloon__list-item__ico"><i class="ico ico_folder ico ico_folder_important"></i></div> ';try{e+=i18n("Отметить флажком")}catch(o){t(o.message+"11")}e+='</div><div class="balloon__list-item"><div class="balloon__list-item__ico"><i class="ico ico_folder ico ico_folder_unread"></i></div> ';try{e+=i18n("Сделать непрочитанным")}catch(o){t(o.message+"17")}e+='</div><div class="balloon__list-item"><div class="balloon__list-item__ico"><span class="ico b-letter__head__calendar_icon"><span class="b-letter__head__calendar_day js-day"><script>var day = (new Date()).getDate();\n\t\t\t\t\t\t\t\t$(\'.balloon__list-item__ico .js-day\').text(day);<\/script></span></span></div> ';try{e+=i18n("Добавить событие в календарь")}catch(o){t(o.message+"28")}e+='</div><div style="padding-top: 10px"><button class="btn btn_main js-button-close" style="white-space: nowrap;">Спасибо, мне понятно</button></div></div>';return e}}();!function(o){_["balloon__threads-promo"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_threads-promo"></i></div><div class="balloon__message"><strong>';try{e+=i18n("Группировка писем")}catch(o){t(o.message+"8")}e+='</strong><p style="margin:6px 0 10px;">';try{e+=i18n("Включите группировку писем")}catch(o){t(o.message+"11")}e+="<br/>";try{e+=i18n("или ")}catch(o){t(o.message+"13")}e+=' <a class="pseudo-link" href="#">узнайте больше</a>';try{e+=i18n(" об&nbsp;этой&nbsp;возможности")}catch(o){t(o.message+"13")}e+='</p><button class="btn btn_main" style="white-space: nowrap;">';try{e+=i18n("Включить группировку")}catch(o){t(o.message+"16")}e+="</button></div>";return e}}();!function(o){var e=o;_["balloon__theme-rio2016"]=function(o){var n="";n+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_theme-rio2016"></i></div><div class="balloon__message" style="margin: 9px 0 -10px;">';try{n+=i18n("Следите за летними играми в Рио прямо ")}catch(o){t(o.message+"7")}n+="<br/>";try{n+=i18n(" в&nbsp; Почте.")}catch(o){t(o.message+"7")}n+=" ";try{b[0]=i(e.href)}catch(o){b[0]="";t(o.message)}n+='<a href="'+b[0]+'">';try{n+=i18n("Установите тему")}catch(o){t(o.message+"10")}n+="</a></div>";return n}}(o);!function(o){_.balloon__filters=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_filters"></i></div><div class="balloon__message">';try{e+=i18n("Фильтруйте письма с&nbsp;вложениями, флажками и&nbsp;непрочитанные в&nbsp;один клик")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_["balloon__html-signature"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_html-signature"></i></div><div class="balloon__message"><a href="/settings/signature">Добавьте картинку</a>';try{e+=i18n(" или&nbsp;логотип к&nbsp;вашей подписи")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){var e=o;_["balloon__theme-cska"]=function(o){var n="";n+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_theme-cska"></i></div><div class="balloon__message" style="margin: 9px 0 -10px;">';try{n+=i18n("Болеете за ЦСКА?")}catch(o){t(o.message+"7")}n+="<br/>";try{b[0]=i(e.href)}catch(o){b[0]="";t(o.message)}n+='<a href="'+b[0]+'" class="balloon__message__link">Установите тему</a></div>';return n}}(o);!function(o){_["balloon__push-notifications"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_push-notifications"></i></div><div class="balloon__message" style="padding-top: 15px;"><a href="/settings/notifications?nosms=1" class="js-balloon__push-notifications__link">Включите</a>';try{e+=i18n(" уведомления о новых письмах в почте")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){var e=o;_["balloon__bonus-promo"]=function(o){var i="";i+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon_bonus-promo"></i></div><div class="balloon__message balloon__message_bonus-promo"><span class="balloon__message-header">';try{i+=e.header}catch(o){t(o.message+"8")}i+='</span><p class="balloon__message-text">';try{i+=e.text}catch(o){t(o.message+"11")}i+='</p><a class="btn btn_main js-link" target="_blank" href="http://r.mail.ru/n257133921">';try{i+=e.btn}catch(o){t(o.message+"14")}i+="</a></div>";return i}}(o);!function(o){_["balloon__compose-schedule"]=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_compose-schedule"></i></div><div class="balloon__message">';try{e+=i18n("Запланируйте отправку письма на определенное время")}catch(o){t(o.message+"7")}e+="</div>";return e}}();!function(o){_.balloon__unsubscribe=function(o){var e="";e+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_unsubscribe"></i></div><div class="balloon__message" style="padding-top:7px; min-height:40px;">';try{e+=i18n("Не нравится эта рассылка? ")}catch(o){t(o.message+"7")}e+="<br/>";try{e+=i18n("Отпишитесь в один клик!")}catch(o){t(o.message+"9")}e+="</div>";return e}}();!function(o){_["balloon__settings-beta"]=function(o){var e="";e+='<div class="balloon__message balloon__message_beta-settings">';try{e+=i18n("Здесь вы всегда сможете узнать о появлении")}catch(o){t(o.message+"4")}e+="<br/>";try{e+=i18n("новых функций и быстро их активировать")}catch(o){t(o.message+"4")}e+="</div>";return e}}();!function(o){var e=o;_.balloon__metathreads=function(o){var i="";i+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_metathreads"></i></div><div class="balloon__message balloon__message_metathreads"><div class="balloon__message__head">';try{i+=e.header}catch(o){t(o.message+"8")}i+='</div><div class="balloon__message__text">';try{i+=e.text}catch(o){t(o.message+"11")}i+="</div></div>";return i}}(o);!function(o){var e=o;_.balloon__octavius=function(o){var i="";i+='<div class="icon-wrap icon-wrap_left icon-wrap_balloon"><i class="icon icon__balloon icon__balloon_octavius"></i></div><div class="balloon__message balloon__message_octavius"><div class="balloon__message__head">';try{i+=e.header}catch(o){t(o.message+"8")}i+='</div><div class="balloon__message__text">';try{i+=e.text}catch(o){t(o.message+"11")}i+="</div></div>";return i}}(o);try{a=$.block}catch(o){a=!1;t(o.message)}if(a){try{s=$.block}catch(o){s="";t(o.message)}h={};try{h=$.params||$}catch(o){t(o.message)}m.push(u,{name:s,params:h,cp:!1});u=""}r=m.length;if(r){l=0;for(;l<r;l++){n=m[l];if("string"==typeof n)f+=n;else{c=_[n.name];if(c)f+=function(o,t,e){if(e)for(var i in t)if("function"==typeof t[i]&&t[i].param)t[i]=t[i]();return o.call(d,t)}(c,n.params,n.cp)}}return f+u}else return u};return o.fest["balloon.all"]});define("promo/balloons/patron.ui.TipOfTheDay",["ajs","promo/fest/balloon.all","jquery"],function(ajs,getBalloonTemplate,$){"use strict";var _getUniqId=ajs.uniqId?function(o){return ajs.uniqId(o)}:function(o){return jsCore.getUniqId(o)};$(window).bind("resize scroll click",function(o){patron.ui.TipOfTheDay.change(o)});$(document).bind("sticky",function(o){patron.ui.TipOfTheDay.change(o)});jsEvent.invert=jsEvent.invert||{};jsEvent.invert.focus="blur";jsEvent.invert.keydown="keyup";jsEvent.invert.mouseover="mouseout";jsEvent.invert.mouseenter="mouseleave";Object.forEach(jsEvent.invert,function(o,t){jsEvent.invert[o]=t});jsClass.create("patron.ui.TipOfTheDay").statics({zIndex:1e3,items:[],change:function(o){Array.forEach(this.items,function(t){t._event(o,"change")})}}).methods({__construct:function(o,t){Object.extend(this,{idTpl:"#TipOfTheDay",orientation:"auto",positionX:"auto",offset:"auto",margin:[30,5],width:0,height:0,cssTH:".th-place",cssClose:".balloon__icon",clOrientation:["balloon_tl","balloon_tr","balloon_br","balloon_bl","balloon_tc","balloon__lt","balloon__lc","balloon__lb","balloon__rt","balloon__rc","balloon__rb"],clPercentOffset:[.25,.5,.75],visible:!0,zIndex:patron.ui.TipOfTheDay.zIndex++,maxShow:1,showBy:0,hideBy:0,absolute:!0,hideByElement:!0},t);this.$Elm=$(o);var e=document.createElement("div");e.innerHTML=getBalloonTemplate({block:"balloon"});var i=$(e.childNodes);this.$Balloon=i.attr("id","").attr("data-id",t.id).css({zIndex:this.zIndex,position:"absolute",display:"none"});if(this.className)this.$Balloon.addClass(this.className);if(this.absolute)$("body,#ScrollBodyInner").last().append(this.$Balloon);else this.$Elm.append(this.$Balloon.css({left:"",top:""}));this.bStyle=this.$Balloon[0].style;this._dEvent=this._event.bind(this);this._dEventScroll=this._event.debounce(50,this);this._eShow=function(o){this._event(o,"show")}.bind(this);this._eHide=function(o){this._event(o,"hide")}.bind(this);this._events(!0,this.showBy,this._eShow);if(this.showBy)this.showBy=this.showBy.replace(/([^:]|^)(eval|timeout):\w+/gi,"$1");if(this.cssClose)this.$Balloon.delegate(this.cssClose,"tap",function(o){this.dispatchEvent("close",this,o);this._eHide()}.bind(this));if(this.text)this.setter("text",this.text);if(this.html)this.setter("html",this.html);if(this.width)this.setter("width",this.width);if(this.height)this.setter("height",this.height);if(this.visible){this.visible=!1;this._event(0,"show")}if(this.onInit)this.onInit.call(this,this);patron.ui.TipOfTheDay.items.push(this)},_findElms:function(o){return $(o.split(",")).map(function(o,t){return $(t)[0]}.bind(this))},_events:function(bind,cmds,func){var $elm,fId=_getUniqId(func);if(cmds)Array.forEach(cmds.split(/,?\s+/g),function(cmd){if(cmd){cmd=cmd.split(":");$elm=this._findElms(cmd[0]);if("eval"==cmd[0]&&eval(cmd[1]))func();else if("timeout"==cmd[0]){clearTimeout(this[fId]);if(bind)this[fId]=setTimeout(func,cmd[1])}else if(bind&&cmd[2]>0)$elm.bind(cmd[1],function(){var o=_getUniqId(this),t=setTimeout(func,cmd[2]),e=jsEvent.invert[cmd[1]],i=e+"_"+o;if(e){if(window[i]){window[i]();$elm.unbind(e,window[i])}$elm.bind(e,window[i]=function(){clearTimeout(t)})}});else if(defined(cmd[2])&&!(cmd[2]>0)){var efunc=fId+cmd.join("");if(!window[efunc])window[efunc]=function(evt){setTimeout(function(){if(eval(cmd[2]))func(evt)},5)};$elm[bind?"bind":"unbind"](cmd[1],window[efunc])}else $elm[bind?"bind":"unbind"](cmd[1],func)}},this)},_event:function(o,t){t=t||o.type;switch(t){case"click":case"change":case"resize":if($.isFunction(this.getContainer))this.$Elm=this.getContainer();if(!this.$Elm.length)this._bIsHide=!0;else this._bIsHide=!this.$Elm[0].offsetWidth;if(this.visible&&this.hideByElement&&this._bIsHide){this.$Balloon[this._bIsHide?"hide":"show"]();if(this._bIsHide)return}Object.extend(this,this.$Elm.offset());this.eWidth=this.$Elm.width();this.eHeight=this.$Elm.height();this.bWidth=this.$Balloon.width();this.bHeight=this.$Balloon.height();this.wWidth=ajs.windowWidth()-40;this.wHeight=ajs.windowHeight()-20;case"scroll":if(this.visible&&!this._bIsHide){this.wLeft=ajs.scrollLeft();this.wTop=ajs.scrollTop();this._pos()}break;case"show":if(!this.visible)if(this.maxShow>0||-1==this.maxShow){if(this.maxShow>0)this.maxShow--;if(window.jsHistory)jsHistory.oneTop(function(o){this._event(o,"hide")}.bind(this));$(window).bind("resize scroll",this._dEventScroll);this._event(o,"resize");if(this.withoutCross)this.$Balloon.find(".balloon__icon").hide();if(patron.TestAnimationsBalloons&&Modernizr.keyframes&&!this.fadeAnimation)this.$Balloon.addClass("balloon_effect-show").slideDown(250,function(){this._event(0,"resize")}.bind(this));else if(this.fadeAnimation)this.$Balloon.addClass("balloon_effect-show").fadeIn(250,function(){this._event(0,"resize")}.bind(this));else this.$Balloon.display(!0);this.visible=!0;this._events(!0,this.hideBy,this._eHide);this._events(!1,this.showBy,this._eShow);this.dispatchEvent(t,this,o)}break;case"hide":if(this.visible&&(!o||!this.$Balloon.has(o.target).length)){$(window).unbind("resize scroll",this._dEventScroll);if(patron.TestAnimationsBalloons&&Modernizr.keyframes&&!this.fadeAnimation)this.$Balloon.removeClass("balloon_effect-show").slideUp(250);else if(this.fadeAnimation)this.$Balloon.removeClass("balloon_effect-show").fadeOut(250);else this.$Balloon.display(!1);this.visible=!1;this._events(!1,this.hideBy,this._eHide);this.dispatchEvent(t,this,o)}}},_pos:function(){var o,t=this.orientation,e=this.positionX,i=0,n=0,s=this.left,a=this.top;if(!this.absolute){o=this.margin;this.margin=[0,0]}if("left"==t||"right"==t){i="center"==e?6:"bottom"==e?7:5;n=this.clPercentOffset[i-5];a=a-n*(this.bHeight-40)-20-this.margin[1];if("auto"==e&&a+this.bHeight>this.wTop+this.wHeight){i=7;n=this.clPercentOffset[i-5];a=this.top-n*(this.bHeight-40)-20-this.margin[1]}}else if("right"==e||"center"!=t&&s+this.bWidth-this.margin[0]>this.wLeft+this.wWidth){i=1;s=s-this.bWidth+this.margin[0]}else s-=this.margin[0];if("auto"==t||t.match(/-(\w+)/))if("auto"!=t)if("top"==RegExp.$1)t=a-this.bHeight-this.wTop>0?"top":"bottom";else t=this.wHeight+this.wTop-a-this.bHeight>0?"bottom":"top";else t=a-this.bHeight-this.wTop>0?"top":"bottom";if("top"==t){a-=this.bHeight-this.margin[1];i=1==i?2:3}else if("left"==t){i+=3;s+=-this.bWidth+this.margin[0]}else if("right"==t)s+=this.eWidth-this.margin[0];else a+=this.eHeight-this.margin[1];if("center"==t)i=4;this.$Balloon.removeClass(this.clOrientation.join(" ")).addClass(this.clOrientation[i]);if("auto"==this.offset)if("left"==t||"right"==t)a+=this.eHeight/2;else s+=this.eWidth/2;if(this.absolute){this.bStyle.left=s+"px";this.bStyle.top=a+"px"}else{this.margin=o;this.bStyle.marginLeft=this.margin[0]+"px";this.bStyle.marginTop=this.margin[1]+"px"}},setter:function(o,t){switch(o){case"text":case"html":this.$Balloon.find(this.cssTH)[o](t);break;case"visible":this._event(0,t?"show":"hide");break;case"width":case"height":this.$Balloon.css(o,t);break;default:this[o]=t}this._event(0,"resize")},getter:function(o){var t;switch(o){case"width":case"height":t=this.$Balloon[o]();break;case"balloon":t=this.$Balloon;break;default:t=this[o]}return t},hide:function(){this._eHide()}});$.fn.TipOfTheDay=function(o,t){var e,i,n=this;this.each(function(){e=$(this);i=e.data("patron.ui.TipOfTheDay");if(!defined(o)||$.isPlainObject(o))if(i&&i.html===o.html)i._eShow();else e.data("patron.ui.TipOfTheDay",new patron.ui.TipOfTheDay(this,o));else if(defined(t))i.setter(o,t);else n=i.getter(o)});return n}});define("promo/balloons/patron.Balloon",["patron.v2/flags/flags","patron.v2/utils/features","liaz677","push-manager","promo/fest/balloon.all","jquery","patron/patron.core","ajs/__string/ajs__string","patron/patron.Ajax","patron/patron.API","utils/jsHistory","utils/Counter","promo/balloons/patron.ui.TipOfTheDay"],function(o,t,e,i,n){e.on("balloonRedraw",function(){patron.Balloon.redraw()});var s=function(o){var t,e,i=function(){t=$("#portal-menu");e=t.find('[data-name="ph-more"]')};return function(o){if(!t)i();var n=t.find('[data-name="ph-'+o+'"]');if(n[0]&&"none"!=n[0].style.display)return n.eq(0);else return e}}(),a=function(){return function(o){if(0===o.length)return!1;else if(o.hasClass("pm-toolbar__button"))return"none"!=o[0].style.display;return o.is(":visible")}}();jsClass.create("patron.Balloon").statics({SHOW_TIME_LIMIT:(t.get("balloon-show-time-limit")||{}).data||43200,items:[],defaultOptions:{counters:{},autoOpen:!0,balloonOptions:{hideBy:"body:mousedown",width:288,orientation:"bottom",positionX:"right",maxShow:-1,timestampOnClose:!1}},isLocked:function(){return patron.notificationLocker().isLocked()},setLock:function(o){patron.notificationLocker().setLock(o)},isEnable:function(){return!(patron.BalloonNotifyDisabled||$.browser.msie&&parseInt($.browser.version,10)<7||patron.DisabledNoAuthLayer)},isValid:function(){var o=!1,t=patron.HelperIndex.validDataFlag;if(this.isClosed(t))o=!0;else this.makeAsClosed(t);return o},push:function(){for(var o,e=arguments.length;e--;)if(this.test(o=arguments[e]))this.items.push(new patron.Balloon(o));else if((t.get("balloon-test")||{}).state)this.items.push(new patron.Balloon(o))},add:function(o){this.push(o);if(!this.previos&&this.inited)this.redraw()},test:function(e){var i,n=!0;if(t.has("disable-ballons"))return!1;if("id"in e)if(patron.Balloon.isBitFlag(e.id)){if(this.isClosed(e.id))n=!1}else{i=o.get(e.id);if(!e.ignoreInactive&&i&&i.isActive())n=!1}return n},redraw:function(){this.inited=!0;if(!this.isLocked()){var o;this.sortByPriority();if(o=this.items[0])this.itemRedraw(o,0)}},itemRedraw:function(o,t){var e=this.itemRedrawDone.bind(this,o),i=this.itemRedrawFail.bind(this,o,t),n=$.Deferred().done(e).fail(i);o.redraw(n)},itemRedrawDone:function(o){var t=o.options;if(this.previos)this.previos.hide();this.previos=o;if(t.autoOpen)o.show();else if(t.openEvent)$(window).one(t.openEvent,{scope:o},function(t){o.show()})},itemRedrawFail:function(o,t){var e;if(void 0!==t)e=this.items[++t];if(e)this.itemRedraw(e,t);else if(this.previos){this.previos.hide();this.previos=null}},sortByPriority:function(){this.items.sort(function(o,t){return~~o.options.priority-~~t.options.priority})},makeAsShowed:function(o,t,e,i){var n=i&&this.getCurrentTimestamp();this.setTimestamp(o,n,t,e)},makeAsClosed:function(o){var t=$.Deferred();if(this.isClosed(o))t.resolve();else{this.updateStatus(o,t.resolve);this.removeItemById(o)}return t},setTimestamp:function(t,e,i,n){if(this.isBitFlag(t))patron.Ajax({type:"POST",url:"/cgi-bin/ajax_helper?ajax_call=1&func_name=set_helper_timestamp",data:{helper:t,helper_timestamp:patron.HelperTimestamp[t]=e},complete:i});else o.get(t).save({time:!!e,hit:!!n}).then(i)},updateStatus:function(t,e){if(this.isBitFlag(t))patron.API.post("helper/set",{index:t},function(o){if(o.isOK())patron.HelperStatus=o.getBody().status;if(e)e()});else{o.get(t).save({index:!0}).then(function(){if(e)e()})}},unsetIndex:function(o,t){patron.API.post("helper/unset",{index:o},function(o){if(o.isOK())patron.HelperStatus=o.getBody().status;if(t)t()})},setStatus:function(o){patron.Ajax({type:"POST",url:"/cgi-bin/ajax_helper?ajax_call=1&func_name=set_helper_status&token="+window.mailru_api_token,data:{helper_mask:patron.HelperStatus=o}})},isClosed:function(t){if(this.isBitFlag(t)){var e=1<<t;return(patron.HelperStatus&e)===e}else return!o.get(t).state},removeItemById:function(o){for(var t,e=this.items.length;e--;){t=this.items[e];if(t.options.id==o){this.items.splice(e,1);break}}},getItemById:function(o){for(var t,e=this.items.length;e--;){t=this.items[e];if(t.options.id==o)return t}return null},inArray:function(o,t){for(var e=t.length;e--;)if(-1!==t[e].indexOf(o))return!0;return!1},getCurrentTimestamp:function(){return Math.round(Date.getTime()/1e3-patron.CurrentTimestampOffset)},getLastShowTime:function(){var t=0,e=[];Array.forEach(this.items,function(t){if(t&&t.options.id)if("number"==typeof t.options.id)e.push(patron.HelperTimestamp[t.options.id]);else{var i=o.get(t.options.id);if(i)e.push(i.time)}});for(var i=e.length;i--;)t=Math.max(t,e[i]);return t},checkAccess:function(){for(var o,t=!0,e=this.items.length;e--;){o=this.items[e];if(o.showed&&!o.closed&&!o.hided){t=!1;break}}return t},isShowed:function(t){return(this.isBitFlag(t)?patron.HelperTimestamp[t]:o.get(t).time)>1},getShowTime:function(t){return this.isBitFlag(t)?patron.HelperTimestamp[t]:o.get(t).time},isExpired:function(t,e){var i=this.isBitFlag(t)?patron.HelperTimestamp[t]:o.get(t).time;return this.getCurrentTimestamp()-i>=e},isBitFlag:function(o){var t=parseInt(o,10);return 0<=t&&t<32}}).methods({__construct:function(o){var t=this;this.$container=$();this.$balloon=$();this.options=$.extend(!0,{},patron.Balloon.defaultOptions,o,{balloonOptions:{onClose:function(){t.close();o.balloonOptions&&o.balloonOptions.onClose&&o.balloonOptions.onClose.apply(this,arguments)},onHide:function(){t.hide();o.balloonOptions&&o.balloonOptions.onHide&&o.balloonOptions.onHide.apply(this,arguments)}}});if(this.options.event)$(window).bind(this.options.event,{scope:this},function(o){var t=o.data.scope;if("id"in t.options)patron.Balloon.makeAsClosed(t.options.id)
;if(t.options.counters.showAndDo&&t.showed)if(patron.Balloon.isBitFlag(this.options.id))Counter.d(t.options.counters.showAndDo);else $.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,this.options.event]})}.bind(this))},redraw:function(o){this.test(o)},show:function(){if(this.options.balloonOptions.loadHTML&&!this.options.balloonOptions.html)patron.Ajax({url:"/cgi-bin/lstatic",dataType:"text",data:{get:"balloon",name:this.options.id,lang:patron.LANG,SpamBallonExp:patron.SpamBallonExp,SettingsOn:patron.SettingsOn?1:0,staticDomainName:patron.staticDomainName},success:function(o){if(o.isOK()){this.options.balloonOptions.html=o.getData();this.showBalloon()}}.bind(this)});else this.showBalloon()},showBalloon:function(o){var t=this.getContainer();this.options.balloonOptions.getContainer=this.getContainer.bind(this);this.options.balloonOptions.id=this.options.id;this.$balloon=t.TipOfTheDay(this.options.balloonOptions);this.showed=1;if("id"in this.options)patron.Balloon.makeAsShowed(this.options.id,null,!patron.Balloon.isBitFlag(this.options.id),!this.options.balloonOptions.timestampOnClose);$(window).bind("beforeunload.balloon",{scope:this},function(o){var t=o.data.scope;if(o.originalEvent)if(t.showed&&!t.closed&&!t.hided)Counter.d(604800)});if(this.options.counters&&this.options.counters.show)if(patron.Balloon.isBitFlag(this.options.id))Counter.d(this.options.counters.show);else $.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,"show"]});var e=this.options.resolve;if($.isFunction(e))e.call(this);patron.Balloon.setLock(!0)},close:function(){this.closed=1;if("id"in this.options)patron.Balloon.makeAsClosed(this.options.id);if(this.options.counters.close)if(patron.Balloon.isBitFlag(this.options.id))Counter.sb(this.options.counters.close);else{o.get(this.options.id).save({close:!0,time:!!this.options.balloonOptions.timestampOnClose});$.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,"close"]})}Counter.d(604797);$(window).unbind(".balloon")},hide:function(){this.hided=1;var o=this.$balloon.data("patron.ui.TipOfTheDay");if(o)o._eHide();Counter.d(604799);$(window).unbind(".balloon");patron.Balloon.setLock(!1);if(this.options.counters.hide)if(patron.Balloon.isBitFlag(this.options.id))Counter.sb(this.options.counters.hide);else $.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,"hide"]})},test:function(e){var i=!0,n=this.options,s=n.test,l=this.getContainer(),r=patron.Balloon.getCurrentTimestamp(),c=patron.Balloon.getLastShowTime();n.regTimeLimit=n.regTimeLimit||60*((t.get("default-reg-time-limit")||{}).data||0)*60;if(t.get("balloon-show-time-limit"))n.timeLimit=t.get("balloon-show-time-limit").data;var h=t.get("balloon-test")||{},p=(h.data||"").split(":"),d=p[0],u=parseInt(p[1],10);if(h.state&&h.data)if(n.id==d)if(u>0)setTimeout(function(){e.resolve()},u);else e.resolve();else e.reject();else{if(n.forceShow){i="showed"!==n.forceShow;n.forceShow="showed"}else if(!patron.Balloon.test(n))i=!1;else if(patron.newreg)i=!1;else if(c>r-patron.Balloon.SHOW_TIME_LIMIT&&!n.ignorShowTimeLimit)i=!1;else if(n.disposable&&patron.Balloon.isShowed(n.id))i=!1;else if(n.regTimeLimit&&o.get("tutorial-widget")&&o.get("tutorial-widget").getTimeDelta(patron.CurrentTimestamp)<n.regTimeLimit)i=!1;else if(n.timeLimit&&patron.Balloon.getShowTime(n.id)>r-n.timeLimit)i=!1;else if(n.selector&&!a(l))i=!1;if(i)if($.isFunction(s))s.call(this,e);else e.resolve();else e.reject()}},getContainer:function(){var o=this.options.selector;if($.isFunction(o))o=o.call(this);return $(o)}});if(patron.TestHelpersClearAllStatus)patron.Balloon.setStatus(0);if(patron.TestHelpersClearAllShowTime)$.each(patron.HelperTimestamp,function(o){patron.Balloon.setTimestamp(o,1)});if(patron.Balloon.isEnable()){if(patron.Balloon.isValid()){var l=patron.SpamBallonExp;if(t.has("balloon-spam"))patron.Balloon.push({id:patron.HelperIndex.spam,selector:function(){return $($('[data-mnemo="toolbar-letter"] [data-name="spam"]:visible').get(0))},event:"spamLinkClick.readmsg",priority:20,timeLimit:2592e3,regTimeLimit:2592e3,counters:{show:l?1108777:427005,close:427005,showAndDo:l?1108777:604793},test:function(o){if((patron.isReadMsgPage()||patron.isThreadPage())&&!patron.Folders.get().isSent())require(["patron/patron.Messages"],function(o){var t,e=!1;if(GET.id){var i=patron.Messages.get(GET.id);if(i)t=i.From}if(!t||-1===t.indexOf("@corp.mail.ru"))e=!0;if(e)if(t)require(["patron/patron"],function(){patron.Utils.isInAddressBook(t,function(t){if(t)o.reject();else o.resolve()})});else o.resolve();else o.reject()}.bind(this,o));else o.reject()},balloonOptions:{margin:[45,0],zIndex:1100,html:n({block:"balloon__spam"})}});if(t.has("balloon-nospam"))patron.Balloon.push({id:patron.HelperIndex.nospam,selector:function(){return $($('[data-mnemo="toolbar-letter"] [data-name="noSpam"]:visible').get(0))},priority:30,event:"nospamLinkClick.readmsg",timeLimit:1209600,regTimeLimit:1209600,counters:{show:427007,close:427007,showAndDo:604794},test:function(o){if(patron.isReadMsgPage()||patron.isThreadPage())require(["patron/patron.Messages"],function(o){var t,e=!1;if(GET.id){var i=patron.Messages.get(GET.id);if(i)t=i.From}if(!t||-1===t.indexOf("@corp.mail.ru"))e=!0;if(e)if(t)require(["patron/patron"],function(){patron.Utils.isInAddressBook(t,function(t){if(t)o.reject();else o.resolve()})});else o.resolve();else o.reject()}.bind(this,o));else o.reject()},balloonOptions:{margin:[45,0],zIndex:1100,html:n({block:"balloon__nospam"})}});if(patron.RegisterMailtoHandler)patron.Balloon.push({id:patron.HelperIndex.mailtoObserver,priority:11,timeLimit:patron.RegisterMailtoHandlerForce?0:2592e3,test:function(o){var t=!$.browser.opera&&$.isFunction(navigator.registerProtocolHandler);if(t){!function(){var o=patron.getPageURL("compose")+"?mailto=%s";try{navigator.registerProtocolHandler("mailto",o,patron.IsMyCom?"myMail":patron.SingleProductName)}catch(o){}}();if(patron.RegisterMailtoHandlerForce)o.reject();else o.resolve()}else o.reject()}});if(t.has("balloon-filesearch"))patron.Balloon.push({id:patron.HelperIndex.filesearch,selector:function(){return $(s("files"))},priority:60,regTimeLimit:1209600,disposable:!0,counters:{show:924461,close:924461},xcounters:{show:874511,close:874511},test:function(o){if(patron.isFileSearchPage())o.reject();else o.resolve()},balloonOptions:{onInit:function(){this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){location.href="/filesearch"})},width:278,positionX:"left",margin:[34,3],absolute:!0,zIndex:901,html:n({block:"balloon__filesearch"})}});if(!patron.IsExternalAccount&&t.has("balloon-collector"))patron.Balloon.push({id:patron.HelperIndex.collector,selector:function(o){return s("more")},priority:10,counters:{show:816839,close:816846},disposable:!0,test:function(o){if(!patron.FromCollector&&!patron.isSettingsPage()&&!Object.keys(patron.collectors).length)o.resolve();else o.reject()},balloonOptions:{onInit:function(){$(".js-hide",this.$Balloon).bind("click",function(o){this._eHide();o.preventDefault()}.bind(this))},width:514,orientation:"center",positionX:"left",margin:[267,6],absolute:!0,zIndex:904,html:n({block:"balloon__collector"})}});if(t.has("multiAuthBalloonEnable"))patron.Balloon.push({id:patron.HelperIndex.multiAuth,event:"multiAuthCloseClick",selector:function(){return $("#PH_authView")},priority:12,timeLimit:1209600,regTimeLimit:2592e3,counters:{show:1161658,close:1161658},test:function(o){if(window.__PH&&__PH.isMultiAuth&&__PH.isMultiAuth())o.resolve();else o.reject()},balloonOptions:{onInit:function(){this.$Balloon.css("right",42).find(this.cssTH).css("cursor","pointer").click(function(o){this._eHide();o.preventDefault();if(window.__PH&&__PH.authMenu&&__PH.authMenu.show)__PH.authMenu.show()}.bind(this))},width:270,orientation:"bottom",positionX:"right",margin:[0,-10],absolute:!1,html:n({block:"balloon__multiAuth"})}})}if(!patron.Balloon.isClosed(patron.HelperIndex.multiAuth))$(function(){if(window.__PH&&__PH.isMultiAuth&&__PH.isMultiAuth())if(__PH.authMenu&&__PH.authMenu.once)__PH.authMenu.once("show",function(){patron.Balloon.makeAsClosed(patron.HelperIndex.multiAuth)})});if(t.has("showCloudBalloon"))!function(o,t){if(o[t]<1383132273)patron.HelperStatus&=~(1<<t);patron.Balloon.push({id:t,selector:function(){return $(s("cloud"))},priority:10,timeLimit:2592e3,regTimeLimit:2592e3,counters:{show:2299277,close:2299290},balloonOptions:{className:"balloon__cloud",width:263,orientation:"center",positionX:"left",margin:[-123,-6],absolute:!!patron.UseFlatHeader,zIndex:906,html:n({block:"balloon__cloud"})}})}(patron.HelperTimestamp,patron.HelperIndex.cloud);if(t.has("showAttachFromCloudBalloon")){!function(o,t){if(o[t]<1405972800){o[t]=1;patron.HelperStatus&=~(1<<t)}}(patron.HelperTimestamp,patron.HelperIndex.attachFromCloud);patron.Balloon.push({id:patron.HelperIndex.attachFromCloud,selector:"body",priority:10,disposable:!0,regTimeLimit:2592e3,test:function(o){var t=function(){this.options.selector=function(o){var t=$(".js-multi-attach");if(t.length>1)t=t.filter('[data-source="cloud"]');return t}}.bind(this);if(patron.isComposePage())setTimeout(function(){t();o.resolve()}.bind(this),500);else o.reject()},balloonOptions:{onInit:function(){var o=patron.CommonPurposeBitmask>>15&1;this.$Balloon.find(".js-balloon29-cloud-exists").display(!!o);this.$Balloon.find(".js-balloon29-cloud-not-exists").display(!o)},onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","attachFromCloud","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","attachFromCloud","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","attachFromCloud","close"]})},html:n({block:"balloon__attachFromCloud"}),orientation:"right",positionX:"auto",margin:[t.has("compose2")?-4:-30,0],width:300}})}if(t.has("showComposeTemplatesBalloon"))patron.Balloon.push({id:"compose-templates-balloon",selector:function(){return $($('[data-group="templates"]:visible').get(0))},priority:9,disposable:GET.IsShowComposeTemplatesBalloonForce?!1:!0,counters:{show:!0,close:!0},test:function(o){o.resolve=o.resolve.debounce(500);if(patron.isComposePage()){var t=function(t){if(t&&t.parentView&&"new"==t.parentView.mode)o.resolve();else o.reject()}.bind(this);setTimeout(function(){var o=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive();if(o)t(o);else $(document).one("compose-form-redraw",function(){var o=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive();if(o)t(o)}.bind(this))}.bind(this),1e3)}else o.reject()},balloonOptions:{hideBy:"body:mousedown body:tap",width:284,orientation:"bottom",positionX:"right",margin:[35,2],absolute:!0,zIndex:1101,html:n({block:"balloon__composeTemplates"})}});if(t.has("showComposeTemplatesBalloonReply"))patron.Balloon.push({id:"compose-templates-balloon-reply",selector:function(){return $($('[data-group="templates"]:visible').get(0))},priority:9,timeLimit:5184e3,counters:{show:!0,close:!0},test:function(t){t.resolve=t.resolve.debounce(500);if(patron.isComposePage()){var e=function(e){if(e&&e.parentView&&/^reply(all)?|forward$/.test(e.parentView.mode)){var i=e._formElm("re_msg").val()||e._formElm("fwd_msg").val();patron.Messages.find({id:i}).done(function(e){var i=o.get(this.options.id);if(e.getFolder().isSent()&&!i.getCount("close")&&i.time+this.options.timeLimit<patron.CurrentTimestamp)t.resolve();else t.reject()}.bind(this)).fail(t.reject)}else t.reject()}.bind(this);setTimeout(function(){var o=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive();if(o)e(o);else $(document).one("compose-form-redraw",function(){var o=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive();if(o)e(o)}.bind(this))}.bind(this),1e3)}else t.reject()},balloonOptions:{onInit:function(){var o=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive(),t=o&&"forward"==o.parentView.mode;this.$Balloon.find(".js-reply").display(!t);this.$Balloon.find(".js-forward").display(t)},hideBy:"body:mousedown body:tap",width:252,orientation:"bottom",positionX:"right",margin:[35,2],absolute:!0,zIndex:1101,html:n({block:"balloon__composeTemplatesReply"})}});if(t.has("showArchiveFolderBalloon"))patron.Balloon.push({id:"archive-folder",selector:'.b-toolbar [data-name="archive"]:visible',priority:9,disposable:!0,counters:{show:!0,close:!0,hide:!0},test:function(o){if(patron.Folders.getAll().filter(function(o){return!0===o.get("archive")}).length)o.reject();else o.resolve()},balloonOptions:{width:224,orientation:"bottom",positionX:"right",margin:[48,2],absolute:!0,zIndex:1101,html:n({block:"balloon__archiveFolder"})}});if(t.has("showExpandArchiveBalloon"))patron.Balloon.push({id:"expand-archive",selector:".js-attachments-view .js-expand:visible",priority:9,disposable:!0,counters:{show:!0,close:!0,hide:!0},balloonOptions:{width:228,orientation:"bottom",positionX:"right",margin:[35,2],absolute:!0,zIndex:1101,html:n({block:"balloon__expandArchive"})}});if(t.has("theme-weather"))patron.Balloon.push({id:"theme-weather",selector:function(o){return s("themes")},priority:9,disposable:!0,regTimeLimit:1036800,counters:{show:!0,close:!0,hide:!0},test:function(o){if("t1189"==patron.currentTheme)o.reject();else o.resolve()},balloonOptions:{onInit:function(){this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){$.event.trigger("ui-abstract-action",{chain:["balloon","theme-weather","changeThemeClick"]});location.href=location.pathname+"?setTheme=t1189"}.bind(this))},width:264,orientation:"center",positionX:"left",margin:[142,6],absolute:!0,zIndex:908,html:n({block:"balloon__theme-weather",href:location.pathname+"?setTheme=t1189"})}});if(t.has("balloon-edit-attached-document")&&t.has("enable-edit-attached-document"))patron.Balloon.push({id:"edit-attach",selector:function(o){var t=$(".js-editAttachedFile");if(patron.isAttachViewerPage())t=t.filter('[data-type="file"]');else if(patron.isReadMsgPage())t=t.filter('[data-type="image"]');return t.eq(0)},priority:9,disposable:!0,counters:{show:!0,close:!0,hide:!0},test:function(o){if(patron.isAttachViewerPage()||patron.isReadMsgPage()||patron.isThreadPage())require(["patron/patron.Messages","patron.attachViewer/patron.FullAttachViewer.Editors"],function(t,e){var i,n=patron.FullAttachViewer.Editors;if(patron.isReadMsgPage())i=GET.id;if(patron.isThreadPage()&&patron.view.thread.Content.__inst__)i=patron.view.thread.Content.__inst__.model.get("expand");if(i)t.find({id:i}).then(function(t){var e,i=t.get("attaches"),s=GET._av;try{e=i.list.some(function(o){var t=n.getFileExtention(o.attributes.name),e="image"==n.getFileType(t)&&n.availableEditing(t);if(patron.isAttachViewerPage())return e&&s&&-1!==s.search(o.id);else return e})}catch(o){ajs.log("edit-attach",o)}if(e)o.resolve();else o.reject()},o.reject);else o.reject()});else o.reject()},balloonOptions:{onInit:function(){this.$Balloon.on("click",".js-balloon__link",function(o){this.$Elm.click();this.hide();$.event.trigger("ui-abstract-action",{chain:["baloon","attachment","edit"]});o.preventDefault()}.bind(this))},width:290,height:100,orientation:"top",positionX:"center",margin:[35,10],absolute:!0,zIndex:908,html:n({block:"balloon__edit-attach"})}});if(t.has("horoscope-balloon"))patron.Balloon.push({id:"horoscope-balloon",selector:function(o){return s("themes")},priority:9,disposable:!0,test:function(o){if("t3002"==patron.currentTheme)o.reject();else o.resolve()},balloonOptions:{onInit:function(){Counter.d(19996885);this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){Counter.sb(19996836);location.href=location.pathname+"?setTheme=t3002"}.bind(this))},onClose:function(){Counter.sb(19996881)},width:284,orientation:"center",positionX:"left",margin:[152,6],absolute:!0,zIndex:908,html:n({block:"balloon__horoscope",href:location.pathname+"?setTheme=t3002"})}});if(t.has("balloon-cleaner"))patron.Balloon.push({id:"balloon-cleaner",selector:function(o){return s("settings")},priority:9,disposable:!0,test:function(t){var e=o.get("mailbox-sort");if(e.state&&0===e.getCount("show")&&(patron.isReadMsgPage()||patron.isThreadPage()))t.resolve();else t.reject()},balloonOptions:{onInit:function(){Counter.d(20822441);this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(o){Counter.sb(20822452);o.preventDefault();require(["patron.v2.layer/patron.layer.Cleaner"],function(o){o.showLayer();$.event.trigger("ui-abstract-action",{chain:["mailbox-sort","start"],source:"b-nav"})}.bind(this))}.bind(this))},onClose:function(){Counter.sb(20822459)},width:330,orientation:"center",positionX:"left",margin:[182,6],absolute:!0,zIndex:908,html:n({block:"balloon__cleaner"})}});var r=t.get("balloon-cleaner-archive");if(r)patron.Balloon.push({id:"balloon-cleaner-archive",selector:function(o){return $(".js-cleaner-balloon")},priority:9,disposable:!0,test:function(t){var e=o.get("mailbox-sort"),i=r.dataArray,n=i.every(function(o){return e.time>(0|o)});if(e.getCount("show")&&n)t.resolve();else t.reject()},balloonOptions:{onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","cleaner-archive","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","cleaner-archive","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","cleaner-archive","close"]})},width:300,orientation:"right",positionX:"top",margin:[-8,1],absolute:!0,zIndex:908,html:n({block:"balloon__cleaner-archive"})}});if(t.has("balloon-pins"))patron.Balloon.push({id:"balloon-pins",selector:".b-letter-action_pin:visible:not(.b-letter-action_active)",priority:9,disposable:!0,test:function(o){if(patron.isReadMsgPage()||patron.isThreadPage())o.resolve();else o.reject()},balloonOptions:{onInit:function(){Counter.d(20822463)},onClose:function(){Counter.sb(20822534)},width:280,orientation:"bottom",positionX:"left",margin:[35,3],absolute:!0,zIndex:908,html:n({block:"balloon__pins"})}});if(t.has("balloon-unsubscribe")&&t.get("letter-newsletter-button")){var c;if(1==t.get("letter-newsletter-button").data)c='[data-type="newsletter"] .b-letter-category__button__wrapper .b-letter-category__button__item';else c='[data-type="newsletter"] .b-letter-category__button__link';patron.Balloon.push({id:"balloon-unsubscribe",selector:c,timeLimit:2419200,regTimeLimit:1296e3,priority:9,counters:{close:!0},test:function(t){if(!o.get("balloon-unsubscribe").getCount("close")&&(patron.isReadMsgPage()||patron.isThreadPage()))t.resolve();else t.reject()},balloonOptions:{onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","unsubscribe","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","unsubscribe","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","unsubscribe","close"]})},width:260,orientation:"bottom",positionX:"left",margin:[30,3],absolute:!0,zIndex:908,html:n({block:"balloon__unsubscribe"})}})}if(t.has("balloon-theme-zenit"))patron.Balloon.push({id:"balloon-theme-zenit",selector:function(o){return s("themes")},priority:9,disposable:!0,test:function(o){if("t3005"==patron.currentTheme)o.reject();else o.resolve()},balloonOptions:{onInit:function(){Counter.d(20822600);this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){Counter.sb(20822607);location.href=location.pathname+"?setTheme=t3005"}.bind(this))},onClose:function(){Counter.sb(20822612)},width:260,orientation:"center",positionX:"left",margin:[141,6],absolute:!0,zIndex:908,html:n({block:"balloon__theme-zenit",href:location.pathname+"?setTheme=t3005"})}});if(t.has("balloon-emoji"))patron.Balloon.push({id:"balloon-emoji",selector:"body",priority:9,disposable:!0,test:function(o){var t=function(){this.options.selector=function(o){var t,e,i;t=$(".compose__editor, .b-compose__editor");e=$(".mce_emotions",t);if(e[0]&&"none"!=e[0].style.display)i=e.eq(0);else i=$(".mceToolbarStartButton",t);return i}}.bind(this);if(patron.isComposePage())setTimeout(function(){t();o.resolve()}.bind(this),2e3);else o.reject()},balloonOptions:{onInit:function(){Counter.d(20822541)},onClose:function(){Counter.sb(20822553)},hideBy:"body:mousedown body:tap",forceHide:!0,width:265,orientation:"center",positionX:"left",margin:[144,6],absolute:!0,zIndex:908,html:n({block:"balloon__emoji"})}});if(t.has("balloon-inline-image")&&t.has("compose2"))patron.Balloon.push({id:"balloon-inline-image",selector:"body",priority:9,disposable:!0,test:function(o){var t=function(){this.options.selector=function(o){var t,e,i;t=$(".compose__editor, .b-compose__editor");e=$(".mce-input-holder",t);if(e[0]&&"none"!=e[0].style.display)i=e.eq(0);else i=$(".mceToolbarStartButton",t);return i}}.bind(this);if(patron.isComposePage())setTimeout(function(){t();o.resolve()}.bind(this),2e3);else o.reject()},balloonOptions:{onInit:function(){Counter.d(20822588)},onClose:function(){Counter.sb(20822596)},hideBy:"body:mousedown body:tap",forceHide:!0,width:260,orientation:"center",positionX:"left",margin:[142,2],absolute:!0,zIndex:908,html:n({block:"balloon__inline-image"})}});if(t.has("balloon-html-signature")){var h=["balloon","html-signature",patron.isComposePage()?"compose":"settings"],p=!1;e.on("show-html-signature-balloon",function(){p=!0});patron.Balloon.push({id:"balloon-html-signature",priority:9,disposable:!0,test:function(o){function t(){setTimeout(function(){o.resolve()},1e3)}function i(){if(p)t();else{var i=setTimeout(function(){o.reject()},3e3);e.one("show-html-signature-balloon",function(){clearTimeout(i);t()})}}if(patron.isComposePage()){this.options.selector=function(){return $(".compose__editor, .b-compose__editor").find(".mceToolbarLink.mce_signature")};i()}else if(patron.isSettingsPage()){this.options.selector=function(){return $($(".js-editor")[0]).find(".mceIcon.mce_inlineattach")};i()}else o.reject()},balloonOptions:{onShow:function(){if(patron.isSettingsPage()){var o=this.$Balloon.find(".balloon__message a");o.replaceWith(o.html())}$.event.trigger("ui-abstract-action",{chain:h.concat("show")})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:h.concat("hide")})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:h.concat("close")})},hideBy:"body:mousedown body:tap",forceHide:!0,width:230,orientation:"center",positionX:"left",margin:[127,6],absolute:!0,zIndex:908,html:n({block:"balloon__html-signature"})}})}if(t.has("balloon-theme-rio2016"))patron.Balloon.push({id:"balloon-theme-rio2016",selector:function(o){return s("themes")},priority:9,disposable:!0,test:function(o){if("t3010"==patron.currentTheme)o.reject();else o.resolve()},balloonOptions:{onInit:function(){Counter.d(22223865);this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){Counter.sb(22223870);location.href=location.pathname+"?setTheme=t3010"}.bind(this))},onClose:function(){Counter.sb(22223877)},width:370,orientation:"center",positionX:"left",margin:[195,6],absolute:!0,zIndex:908,html:n({block:"balloon__theme-rio2016",href:location.pathname+"?setTheme=t3010"})}});if(t.has("balloon-filters"))patron.Balloon.push({id:"balloon-filters",selector:function(o){return $($('.b-toolbar__group_right [data-bem="b-radiobuttons"]')[0])},priority:9,disposable:!0,balloonOptions:{onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","filters","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","filters","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","filters","close"]})},width:280,orientation:"center",positionX:"left",margin:[152,6],absolute:!0,zIndex:2e3,html:n({block:"balloon__filters"})}});if(t.has("popup-promo-phones"))patron.Balloon.push({id:"swa-promo-phones",priority:9,timeLimit:0,regTimeLimit:0,ignorShowTimeLimit:!0,ignoreInactive:!0,test:function(e){var i=patron.Router&&patron.Router.request&&patron.Router.request.isInbox&&patron.Router.request.isInbox(),n=t.get("popup-promo-phones"),s=n.data&&n.data.split("|"),a=5184e3,l=2592e3,r=6,c=0;try{var h=Number(s[0]);a=Number.isInteger(h)?86400*h:a;h=Number(s[1]);l=Number.isInteger(h)?86400*h:l;h=Number(s[2]);r=Number.isInteger(h)?h:r;h=Number(s[3]);c=Number.isInteger(h)?h:c}catch(o){}var p=(t.get("balloon-show-time-limit")||{}).data;if(p)a=Number(p);var d=o.get("swa-promo-phones"),u=patron.Balloon.getCurrentTimestamp();if(i&&o.get("tutorial-widget").getTimeDelta(u)>l&&u-d.time>a&&(!d.isActive()||d.count&&d.count.show<r))require(["mail/User"],function(o){o.findOne().then(function(o){var t=o.get("phones")||[];if(c)t=t.filter(function(o){return"ok"===o.status});if(0===t.length)e.resolve();else e.reject()},function(){e.reject()})});else e.reject()},resolve:function(){require(["promo/build/popups"],function(){require("promo/popups/phonesBind").open()})}});if(t.has("settings-react-septima"))patron.Balloon.push({id:"balloon-beta-settings",selector:function(o){return $(".pm-beta-user-widget")},priority:0,test:function(o){if($('[data-id="beta-settings-toggle"]').length)o.resolve();else o.reject()},balloonOptions:{orientation:"bottom",positionX:"left",absolute:!0,zIndex:1100,width:383,fadeAnimation:!0,withoutCross:!0,hideBy:"body:tap body:mousedown",cssClose:".balloon__message_beta-settings",html:n({block:"balloon__settings-beta"})}});if(t.has("balloon-theme-cska"))patron.Balloon.push({id:"balloon-theme-cska",selector:function(o){return s("themes")},priority:9,disposable:!0,test:function(o){if("t3008"==patron.currentTheme)o.reject();else o.resolve()},balloonOptions:{onInit:function(){Counter.d(23132893);this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){Counter.sb(23132894);location.href=location.pathname+"?setTheme=t3008"}.bind(this))},onClose:function(){Counter.sb(23132895)},width:220,orientation:"center",positionX:"left",margin:[122,6],absolute:!0,zIndex:908,html:n({block:"balloon__theme-cska",href:location.pathname+"?setTheme=t3008"})}});if(t.has("push-notifications-balloon")){var d=t.get("push-notifications-balloon").data,u=d&&"autohide"===d,m=t.has("push-notifications-oneclicksubs");patron.Balloon.push({id:"push-notifications-balloon",isAutohide:u,selector:':not(.pm-toolbar__button__inner)[href="/messages/inbox/"]',priority:9,counters:{show:!0},test:function(t){require(["patron/patron.Folders"],function(e){var n=e.get(0),s=o.get("push-notifications-balloon"),a=patron.Balloon.getCurrentTimestamp(),l=s.getCount("close"),r=n.get("messages_unread"),c=!!r;if(patron.isMsgListPage()&&c&&l<2&&(0===l||l>0&&s.getTimeDelta(a)>1209600))i.checkStatus().then(function(o){o?t.reject():t.resolve()}).fail(t.reject);else t.reject()})},balloonOptions:{hideBy:u?"body:mousedown":"",width:260,orientation:"center",positionX:"center",margin:[22,2],absolute:!0,zIndex:908,html:n({block:"balloon__push-notifications"}),forceHide:!0,timestampOnClose:!0,onInit:function(){$(".js-balloon__push-notifications__link",this.$Balloon).bind("click",function(t){$.event.trigger("ui-abstract-action",{chain:["balloon","push-notifications-balloon","link"]});var i=o.get("push-notifications-balloon");i.getCount("close");this._eHide();if(m){t.preventDefault();e.trigger("push-notifications-subscribe")}}.bind(this))},onHide:function(){o.get(this.id).save({close:!0,time:!!this.timestampOnClose});$.event.trigger("ui-abstract-action",{chain:["balloon",this.id,"hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon",this.id,"close"]})}}})}if(t.has("bonus-promo-balloon")&&0==o.get("bonus-seen").time)patron.Balloon.push({id:"bonus-promo-ny",disposable:!0,selector:function(o){return s("bonus")},regTimeLimit:1296e3,balloonOptions:{width:380,zIndex:908,onInit:function(t){Counter.d(26439143);t.$Balloon.delegate(".js-link","click",function(e){t.dispatchEvent("close",t,e);t.hide();$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome1","link"]});o.get("bonus-promo-ny").save({state:!1})})},onShow:function(){$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome1","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome1","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome1","close"]})},html:n({block:"balloon__bonus-promo",header:i18n("Поздравляем!"),text:i18n("Вам стала доступна программа лояльности Mail.Ru — теперь вы можете получать уникальные скидки от лучших магазинов и сервисов рунета. {br}",{"unsafe-br":"<br/>"}),btn:i18n("Перейти в Бонус")}),orientation:"bottom"}});if(t.has("bonus-promo-balloon-split"))patron.Balloon.push({id:"bonus-promo-ny",disposable:!0,selector:function(o){return s("bonus")},counters:{show:!0,hide:!0,close:!0},regTimeLimit:1296e3,balloonOptions:{width:330,zIndex:908,onInit:function(t){t.$Balloon.delegate(".js-link","click",function(e){t.dispatchEvent("close",t,e);t.hide();$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome2","link"]});o.get("bonus-promo-ny").save({state:!1})})},onShow:function(){$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome2","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome2","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["bonus-promo-welcome2","close"]})},html:n({block:"balloon__bonus-promo",header:i18n("Экономьте с Почтой Mail.Ru."),text:i18n("Вашей почте больше 15 дней, и{nbsp}вам стала доступна программа Бонус Mail.Ru с уникальными скидками от наших партнеров.",{"unsafe-nbsp":"&nbsp;"}),btn:i18n("Узнать мою скидку")}),orientation:"bottom"}});if(t.has("balloon-compose-schedule"))patron.Balloon.push({id:"balloon-compose-schedule",selector:"body",priority:9,disposable:!0,test:function(o){var t=function(){this.options.selector=function(){return $('.compose-head [data-blockid="schedule"]')}}.bind(this);if(patron.isComposePage())setTimeout(function(){var e=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive();if(e&&"outbox"!=e.messageMode){t();o.resolve()}else o.reject()}.bind(this),2e3);else o.reject()},balloonOptions:{hideBy:"body:mousedown body:tap",onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","schedule","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","schedule","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","schedule","close"]})},width:260,orientation:"top",positionX:"right",margin:[27,10],absolute:!0,zIndex:908,forceHide:!0,html:n({block:"balloon__compose-schedule"})}})}if(defined(patron.TestHelpersAllRegTimeLimit))$.each(patron.Balloon.items,function(o,t){t.options.regTimeLimit=patron.TestHelpersAllRegTimeLimit});if(defined(patron.TestHelpersAllTimeLimit))$.each(patron.Balloon.items,function(o,t){t.options.timeLimit=patron.TestHelpersAllTimeLimit});$(window).bind("showMessage.readmsg show.msglist",function(){patron.Balloon.redraw()});return patron.Balloon});define("promo/balloons/letters-head-actions",["features","promo/balloons/patron.Balloon","promo/fest/balloon.all"],function(o,t,e){o.has("letters-head-actions")&&t.push({id:"letters-head-actions",selector:".b-letter__controls:first",priority:9,disposable:!0,counters:{show:!0,close:!0,hide:!0},balloonOptions:{onInit:function(){this.$Balloon.find(".js-button-close").bind("click",function(){$.event.trigger("ui-abstract-action",{chain:["balloon","letters-head-actions","button-close"]});this.hide()}.bind(this))},width:345,orientation:"bottom",positionX:"right",margin:[25,2],absolute:!0,zIndex:1101,html:e({block:"balloon__letters-head-actions"})}})});define("promo/balloons/promo-something",["jquery","logger","Promise","patron.v2/flags/flags","features","promo/balloons/patron.Balloon","patron.v2/layer/patron.layer.MessagesLayers"],function(o,t,e,i,n,s,a){"use strict";function l(o){var t=i.get(o);return t&&t.isExist()&&!t.count.show}function r(t){o.event.trigger("ui-abstract-action",{chain:["promo-something"].concat(t)})}var c=t.scope("promo-something");[{id:"promo:mailbox-parsing",test:function(){return n.has("necromant-mailbox-parsing")&&l("promo:mailbox-parsing")},
deps:["patron.v2.layer/patron.layer.Cleaner"],layer:"/promo/cleaner",exec:function(o,t){o&&t.showLayer()}},{id:"promo:mobile-apps",test:function(){return n.has("necromant-mobile-apps")&&l("promo:mobile-apps")},layer:"/promo/mobile",exec:function(o,t){}},{id:"promo:threads",test:function(){return!patron.threads&&n.has("necromant-threads")&&l("promo:threads")},layer:"/promo/threads",deps:["patron/patron.Threads"],exec:function(o,t){o&&t.switchMode(!0,function(){location.reload()})}},{id:"promo:bonus",test:function(){return n.has("necromant-bonus")&&l("promo:bonus")},layer:"/promo/bonus"}].forEach(function(o){s.push({id:o.id,priority:9,disposable:!0,test:function(t){t[o.test()?"resolve":"reject"]()},resolve:function(){function t(t){r([o.id].concat(t))}c.add("promo-something.create.layer",{id:o.id,deps:o.deps,layer:o.layer});require(o.deps||[],function(){var e=Array.from(arguments);a(o.layer,function(i){i.$el.closest(".popup").toggleMod("necromant",!0);i.func=function(i){i=!!i;t(["click",i.toString()]);c.add("promo-something.exec",{id:o.id,layer:o.layer,state:i});o.exec&&o.exec.apply(o,[i].concat(e))};i.show();t(["show"])})})}})});return function(){}});define("promo/balloons/metathreads-promo",["patron.v2/flags/flags","patron.v2/utils/features","mrg-i18n-utils","promo/balloons/patron.Balloon","promo/fest/balloon.all"],function(o,t,i18n,e,i){var n={1:{header:i18n("Скройте рассылки, и в почте станет чище"),text:i18n("Почта скроет рассылки и письма от соцсетей, чтобы они вам не мешали.")},2:{header:i18n("Рассылки — по полочкам"),text:i18n("Умная сортировка автоматически распределит рассылки по категориям.")},3:{header:i18n("Скроем ваши рассылки"),text:i18n("Включите умную сортировку, и рассылки скроются из общего списка.")},4:{header:i18n("Скройте рассылки из списка писем"),text:i18n("Найдем все рассылки в вашей почте и скроем их в специальных категориях.")},5:{header:i18n("Сделаем ваш ящик чище"),text:i18n("Найдем рассылки в почте и распределим их по двум категориям: соцсети и остальные рассылки.")}};if(t.has("balloon-metathreads-promo")){var s=t.get("balloon-metathreads-promo").data||1,a=a=n[s];e.push({id:"balloon-metathreads-promo",selector:'[data-mnemo="toolbar-letters"] [data-group="view"]:visible:first',priority:9,disposable:!1,timeLimit:604800,counters:{show:!0,close:!0,hide:!0},test:function(e){var i=o.get("metathreads-promo")&&o.get("metathreads-promo").state,n=o.get("balloon-metathreads-promo"),s=!n||!n.getCount("close")&&n.getCount("show")<3,a=!t.has("metathreads");if(i&&s&&a)e.resolve();else e.reject()},balloonOptions:{onInit:function(){this.$Balloon.find(".js-button-close").bind("click",function(){$.event.trigger("ui-abstract-action",{chain:["balloon","letters-head-actions","button-close"]});this.hide()}.bind(this))},width:345,orientation:"bottom",positionX:"right",margin:[37,0],absolute:!0,zIndex:1101,html:i({block:"balloon__metathreads",header:a.header,text:a.text})}})}});define("promo/balloons/octavius-promo",["patron.v2/flags/flags","patron.v2/utils/features","mrg-i18n-utils","promo/balloons/patron.Balloon","promo/fest/balloon.all"],function(o,t,i18n,e,i){if(t.has("octavius-balloon-promo"))e.push({id:"octavius-balloon",selector:'[data-mnemo="toolbar-letters"] [data-group="view"]:visible:first',priority:9,disposable:!1,timeLimit:604800,counters:{show:!0,close:!0,hide:!0},test:function(t){var e=o.get("octavius-balloon");if(!e||!e.getCount("close")&&e.getCount("show")<3)t.resolve();else t.reject()},balloonOptions:{width:345,orientation:"bottom",positionX:"right",margin:[37,0],absolute:!0,zIndex:1101,html:i({block:"balloon__octavius",header:i18n("Новая Почта Mail.Ru"),text:i18n("Все меняется, пришло время обновить и почту.")})}})});define("promo/balloons/delayedBalloonRedraw",["promo/balloons/patron.Balloon","promo/balloons/letters-head-actions","promo/balloons/promo-something","promo/balloons/metathreads-promo","promo/balloons/octavius-promo"],function(o){if(patron.BalloonTriggered){patron.BalloonTriggered=!1;o.redraw()}});define("promo/balloons/balloons.all",["promo/balloons/patron.Balloon","promo/balloons/letters-head-actions","promo/balloons/promo-something","promo/balloons/metathreads-promo","promo/balloons/octavius-promo","promo/balloons/delayedBalloonRedraw"],function(){});window.__log.balloon_file_js=0;define("promo/build/balloons",["promo/balloons/balloons.all"],function(){window.__log.balloon_file_js=1});